### **Section C: Core Kubernetes Concepts**

---

#### **10. ConfigMaps and Secrets**

Kubernetes ConfigMaps and Secrets are critical for managing configuration data and sensitive information within your cluster. They enable you to decouple configuration artifacts from container images, making your applications more portable and secure.

##### **10.a. Storing and Managing Configuration Data**

- **Configuration Management in Kubernetes:**
  - **Purpose:** Decoupling configuration data from application code is a best practice that enhances the flexibility and security of your applications. Kubernetes provides ConfigMaps and Secrets to handle non-sensitive and sensitive data, respectively.
  - **Benefits:**
    - **Separation of Concerns:** Configuration can be updated independently of application code.
    - **Portability:** Allows for different configurations across environments (e.g., development, staging, production).
    - **Security:** Sensitive data like passwords and API keys can be stored securely using Secrets.

##### **10.b. Understanding ConfigMaps**

- **What is a ConfigMap?**
  - A ConfigMap is a Kubernetes object that allows you to store configuration data in key-value pairs. It can be used to configure application settings, environment variables, or even whole configuration files.
  
- **Creating a ConfigMap:**
  - **From Literal Values:**
    ```sh
    kubectl create configmap my-config --from-literal=key1=value1 --from-literal=key2=value2
    ```
  - **From a File:**
    ```sh
    kubectl create configmap my-config --from-file=app-config.properties
    ```

- **Using ConfigMaps in Pods:**
  - **As Environment Variables:**
    ```yaml
    apiVersion: v1
    kind: Pod
    metadata:
      name: configmap-pod
    spec:
      containers:
      - name: my-container
        image: nginx
        envFrom:
        - configMapRef:
            name: my-config
    ```
  - **As Volume Mounts:**
    ```yaml
    apiVersion: v1
    kind: Pod
    metadata:
      name: configmap-pod
    spec:
      containers:
      - name: my-container
        image: nginx
        volumeMounts:
        - name: config-volume
          mountPath: /etc/config
      volumes:
      - name: config-volume
        configMap:
          name: my-config
    ```

- **ConfigMap Limitations:**
  - ConfigMaps are not encrypted, so they should not be used to store sensitive data.
  - The size of data stored in a ConfigMap is limited to 1MB by default.

##### **10.c. Managing Sensitive Data with Secrets**

- **What is a Secret?**
  - A Secret is a Kubernetes object used to store and manage sensitive data, such as passwords, tokens, or SSH keys. Secrets are similar to ConfigMaps but offer an additional layer of security.
  
- **Creating a Secret:**
  - **From Literal Values:**
    ```sh
    kubectl create secret generic my-secret --from-literal=password=myPassword
    ```
  - **From a File:**
    ```sh
    kubectl create secret generic my-secret --from-file=ssh-privatekey=~/.ssh/id_rsa
    ```

- **Using Secrets in Pods:**
  - **As Environment Variables:**
    ```yaml
    apiVersion: v1
    kind: Pod
    metadata:
      name: secret-pod
    spec:
      containers:
      - name: my-container
        image: nginx
        env:
        - name: DB_PASSWORD
          valueFrom:
            secretKeyRef:
              name: my-secret
              key: password
    ```
  - **As Volume Mounts:**
    ```yaml
    apiVersion: v1
    kind: Pod
    metadata:
      name: secret-pod
    spec:
      containers:
      - name: my-container
        image: nginx
        volumeMounts:
        - name: secret-volume
          mountPath: /etc/secrets
      volumes:
      - name: secret-volume
        secret:
          secretName: my-secret
    ```

- **Security Considerations:**
  - **Encryption:** Kubernetes encrypts Secrets at rest when stored in etcd, but they are base64-encoded in manifests, so they are not entirely secure when handled outside the cluster.
  - **Access Control:** Control access to Secrets using Kubernetes RBAC (Role-Based Access Control).
  - **Lifecycle Management:** Regularly rotate and update Secrets to minimize the risk of exposure.

##### **10.d. Code Sample: Using ConfigMaps and Secrets in Pods**

- **Example ConfigMap and Secret Setup:**

  **1. Create a ConfigMap:**
  ```sh
  kubectl create configmap app-config --from-literal=app_name=MyApp --from-literal=app_version=1.0
  ```

  **2. Create a Secret:**
  ```sh
  kubectl create secret generic db-secret --from-literal=username=myuser --from-literal=password=mypassword
  ```

  **3. Use in a Pod Manifest:**
  ```yaml
  apiVersion: v1
  kind: Pod
  metadata:
    name: config-secret-pod
  spec:
    containers:
    - name: my-container
      image: nginx
      env:
      - name: APP_NAME
        valueFrom:
          configMapKeyRef:
            name: app-config
            key: app_name
      - name: APP_VERSION
        valueFrom:
          configMapKeyRef:
            name: app-config
            key: app_version
      - name: DB_USERNAME
        valueFrom:
          secretKeyRef:
            name: db-secret
            key: username
      - name: DB_PASSWORD
        valueFrom:
          secretKeyRef:
            name: db-secret
            key: password
      volumeMounts:
      - name: config-volume
        mountPath: /etc/config
      - name: secret-volume
        mountPath: /etc/secrets
    volumes:
    - name: config-volume
      configMap:
        name: app-config
    - name: secret-volume
      secret:
        secretName: db-secret
  ```

  **4. Deploy the Pod:**
  ```sh
  kubectl apply -f pod-config-secret.yaml
  ```

  **5. Verify the Pod:**
  ```sh
  kubectl get pods config-secret-pod
  kubectl exec -it config-secret-pod -- printenv | grep APP_
  ```

---

These notes provide a comprehensive understanding of how to manage configuration data and sensitive information using ConfigMaps and Secrets in Kubernetes. The examples demonstrate practical applications, ensuring that your applications remain both flexible and secure.
